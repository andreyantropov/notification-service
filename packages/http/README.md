# HTTP

–ù–∞–±–æ—Ä —É—Ç–∏–ª–∏—Ç –¥–ª—è HTTP-—Å–µ—Ä–≤–µ—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:  
–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º, middleware –∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã.

> ‚ö†Ô∏è **–≠—Ç–æ—Ç –ø–∞–∫–µ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç Express —Å–∞–º.**  
> –û–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ–≤–µ—Ä—Ö Express**, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω –∏–∑ —Ö–æ—Å—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## üì¶ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ

### üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–µ—Ä–≤–µ—Ä–∞
- **`createServer`** ‚Äî –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ `app.listen()` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
  - graceful shutdown,
  - –∑–∞—â–∏—Ç—ã –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞/–æ—Å—Ç–∞–Ω–æ–≤–∫–∏,
  - —Å–æ—Å—Ç–æ—è–Ω–∏—è (`isStarting`, `isShuttingDown`).

### üßµ Middleware
- **`createAuthenticationMiddleware`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT-—Ç–æ–∫–µ–Ω–∞ (–æ–∂–∏–¥–∞–µ—Ç `req.auth` –æ—Ç `express-oauth2-jwt-bearer`).
- **`createAuthorizationMiddleware`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π –≤ `resource_access` —Ç–æ–∫–µ–Ω–∞ Keycloak.
- **`createRequestLoggerMiddleware`** ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
- **`createInternalServerErrorMiddleware`** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫.
- **`createNotFoundMiddleware`** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ 404.
- **`createTimeoutErrorMiddleware`** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ (`p-timeout`).

### üéØ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
- **`createLoggedServer`** ‚Äî –ª–æ–≥–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫—É —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ `Logger` –∏–∑ `@notification-platform/shared`.

## üß© –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Express ‚â•5.1.0** (–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Ö–æ—Å—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º).
- **`req.auth`** ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω –¥–æ `createAuthorizationMiddleware` (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `express-oauth2-jwt-bearer`).

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```ts
// –í –≤–∞—à–µ–º —Å–µ—Ä–≤–∏—Å–µ
import express from 'express';
import {
  createServer,
  createAuthenticationMiddleware,
  createAuthorizationMiddleware,
  createRequestLoggerMiddleware,
  createLoggedServer,
} from '@notification-platform/http';
import { Logger } from '@notification-platform/shared';

const app = express();
const logger: Logger = /* –≤–∞—à —ç–∫–∑–µ–º–ø–ª—è—Ä –ª–æ–≥–≥–µ—Ä–∞ */;

// Middleware
app.use(createRequestLoggerMiddleware(logger));
app.use(createAuthenticationMiddleware());
app.use(createAuthorizationMiddleware({ serviceClientId: 'notification-service', requiredRoles: ['notify'] }));

// –ú–∞—Ä—à—Ä—É—Ç—ã
app.get('/api/health', (req, res) => res.json({ ok: true }));

// –°–µ—Ä–≤–µ—Ä
const server = createLoggedServer(
  createServer({ app }, { port: 3000 }),
  logger
);

await server.start();
```

## üìÅ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **–ó–∞–≤–∏—Å–∏—Ç –æ—Ç**:  
  `@notification-platform/shared` (–ø–æ—Ä—Ç—ã `Logger`, `Server`).
- **Peer-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:  
  `express` (–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å–æ–º).
- **–ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç**:  
  —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –ª–æ–≥–≥–µ—Ä–∞, HTTP-–∫–ª–∏–µ–Ω—Ç–æ–≤, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ ‚Äî —Ç–æ–ª—å–∫–æ **–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã**.

## üõ†Ô∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

–ü–∞–∫–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –Ω–∞–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:

- `build` ‚Äî –∫–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript-–∫–æ–¥–∞ (`tsc`).  
- `test` ‚Äî –∑–∞–ø—É—Å–∫ unit-—Ç–µ—Å—Ç–æ–≤ –≤ watch-—Ä–µ–∂–∏–º–µ (`vitest`).  
- `test:coverage` ‚Äî –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –æ—Ç—á—ë—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏.  
- `lint` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ —Å –ø–æ–º–æ—â—å—é ESLint.  
- `lint:fix` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–Ω—Ç–∏–Ω–≥–æ–≤—ã—Ö –æ—à–∏–±–æ–∫.  
- `lint:format` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ —Å –ø–æ–º–æ—â—å—é Prettier.  
- `typecheck` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –±–µ–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (`tsc --noEmit`).  

–≠—Ç–∏ —Å–∫—Ä–∏–ø—Ç—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞, –æ—Å–æ–±–µ–Ω–Ω–æ —É—á–∏—Ç—ã–≤–∞—è, —á—Ç–æ –ø–∞–∫–µ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.