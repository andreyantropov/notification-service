# –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

–°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω —Ç–∞–∫, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω—ã–º –¥–∞–∂–µ –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Å–±–æ—è—Ö –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã ‚Äî **fallback-—Ü–µ–ø–æ—á–∫–∏**, **–≥–∏–±–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –∏ **–ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**.

---

## –ü—Ä–∏–Ω—Ü–∏–ø—ã –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

1. **"–†–∞–±–æ—Ç–∞–π, –ø–æ–∫–∞ –º–æ–∂–µ—à—å"**  
   –°–µ—Ä–≤–∏—Å –Ω–µ –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ–¥–Ω–æ–≥–æ –∏–∑ –∫–∞–Ω–∞–ª–æ–≤ (Bitrix, SMTP –∏ –¥—Ä.).

2. **"–î–æ—Å—Ç–∞–≤—å, —á–µ–º –º–æ–∂–µ—à—å"**  
   –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –∫–∞–Ω–∞–ª –∏–∑ —Å–ø–∏—Å–∫–∞ `contacts[]`.  
   –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ö –¥–æ—Å—Ç–∞–≤–∫–∏ ‚Äî —Å–º. [`docs/strategies.md`](./strategies.md).

3. **"–ó–∞–ø–∏—à–∏, —á–µ–º –º–æ–∂–µ—à—å"**  
   –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–π (—Ñ–∞–π–ª ‚Üí –∫–æ–Ω—Å–æ–ª—å).

4. **"–ù–µ —Ç–µ—Ä—è–π –∫–æ–Ω—Ç–µ–∫—Å—Ç"**  
   –í—Å–µ –æ—à–∏–±–∫–∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—é—Ç—Å—è `traceId`, `correlationId` –∏ `eventType`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã —Å–∫–≤–æ–∑—å –≤—Å—é —Å–∏—Å—Ç–µ–º—É.

---

## Fallback –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å:

1. –ü–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –∏–∑ `contacts[]` **–≤ –ø–æ—Ä—è–¥–∫–µ —É–∫–∞–∑–∞–Ω–∏—è**.
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ **–∫–∞–Ω–∞–ª—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç** —ç—Ç–æ—Ç —Ç–∏–ø –ø–æ–ª—É—á–∞—Ç–µ–ª—è.
3. –ü—Ä–æ–±—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å **–ø–æ –ø–µ—Ä–≤–æ–º—É —Ä–∞–±–æ—á–µ–º—É –∫–∞–Ω–∞–ª—É**.
4. –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É.
5. –ï—Å–ª–∏ **–Ω–∏ –æ–¥–∏–Ω –∫–∞–Ω–∞–ª –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª** ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `207 Multi-Status`.

> üí° –ü–æ—Ä—è–¥–æ–∫ –≤ `contacts[]` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–∞–Ω–∞–ª–æ–≤.  
> –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Å–Ω–∞—á–∞–ª–∞ —É–∫–∞–∑–∞–Ω `bitrix`, –∞ –ø–æ—Ç–æ–º `email` ‚Äî email –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–±–æ–µ Bitrix.

---

## Fallback –ø—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏

–î–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –ª–æ–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ü–µ–ø–æ—á–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤:

1. **InfluxDB** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–æ–≤.
2. **–õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª** ‚Äî –µ—Å–ª–∏ InfluxDB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.
3. **–ö–æ–Ω—Å–æ–ª—å (stdout)** ‚Äî –µ—Å–ª–∏ –∏ —Ñ–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

```ts
const logger = createFallbackLogger([influxLogger, fileLogger, consoleLogger]);
```

- –ü–æ–ø—ã—Ç–∫–∏ –∏–¥—É—Ç **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ**.
- –ö–∞–∂–¥–∞—è –æ—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, –Ω–æ **–Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å–µ—Ä–≤–∏—Å–∞**.
- –ï—Å–ª–∏ –≤—Å–µ –ª–æ–≥–≥–µ—Ä—ã –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å ‚Äî –æ—à–∏–±–∫–∞ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è, –Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å—ë —Ä–∞–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è.

> ‚úÖ –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
>
> - –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
> - –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞.
> - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –¥–∞–∂–µ –≤ –∞–≤–∞—Ä–∏–π–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö.

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–°–µ—Ä–≤–∏—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º –∫–∞–∫ —á–∞—Å—Ç—å readiness-—á–µ–∫–∞:

- **SMTP-—Å–µ—Ä–≤–µ—Ä**: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.
- **Bitrix24 API**: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å REST-–º–µ—Ç–æ–¥–æ–≤ –∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞.

–≠—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–¥—è—Ç –≤ `GET /health/ready`:

- ‚úÖ –ï—Å–ª–∏ –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ ‚Äî `200 OK`.
- ‚ùå –ï—Å–ª–∏ –æ–¥–∏–Ω –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî `503 Service Unavailable`.

> ‚ö†Ô∏è –í–∞–∂–Ω–æ: `503` –Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –Ω–µ—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–µ–Ω.  
> –û–Ω –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã, –Ω–æ **–Ω–µ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –Ω–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫** —á–µ—Ä–µ–∑ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫.

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –ò–∑–±–µ–∂–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ "—Å–ª–µ–ø—É—é".
- –ë—ã—Å—Ç—Ä–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ø–∞–¥–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º.
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Å–±–æ—è—Ö.

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–±–æ–µ–≤ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º

| –°—Ü–µ–Ω–∞—Ä–∏–π                              | –û–±—Ä–∞–±–æ—Ç–∫–∞                                               |
| ------------------------------------- | ------------------------------------------------------- |
| Bitrix24 API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω               | –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∫–∞–Ω–∞–ª—É –≤ `contacts[]`              |
| SMTP-—Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω                | –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∫–∞–Ω–∞–ª—É (–µ—Å–ª–∏ –µ—Å—Ç—å)                 |
| InfluxDB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω                   | –õ–æ–≥ –ø–∏—à–µ—Ç—Å—è –≤ —Ñ–∞–π–ª                                      |
| –§–∞–π–ª –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏           | –õ–æ–≥ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å                                 |
| –ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è | –û—à–∏–±–∫–∞: "–ù–µ —É–∫–∞–∑–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞"        |
| –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ `correlationId`  | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–ø–∞—Å–Ω–æ–π ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, timestamp + random) |

> ‚ö†Ô∏è –°–µ—Ä–≤–∏—Å **–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è** –∏–∑-–∑–∞ —Å–±–æ–µ–≤ –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ–¥–Ω–æ–≥–æ –∏–∑ –∫–∞–Ω–∞–ª–æ–≤.

> ‚ö†Ô∏è **–ë—É—Ñ–µ—Ä –≤ –ø–∞–º—è—Ç–∏** ‚Äî –Ω–µ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–µ–Ω. –ü–æ—Ç–µ—Ä—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ ‚Äî –∫–æ–º–ø—Ä–æ–º–∏—Å—Å –≤ –ø–æ–ª—å–∑—É –ø—Ä–æ—Å—Ç–æ—Ç—ã.

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º

- –û—à–∏–±–∫–∏ —É—Ä–æ–≤–Ω—è `error` –∏ `critical` –≤—ã–∑—ã–≤–∞—é—Ç **–∞–ª–µ—Ä—Ç—ã –≤ Telegram**.
- –í—Å–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ **InfluxDB** –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ **Grafana**.
- –ü—Ä–∏ `207 Multi-Status` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—é.
- Health check'–∏ –¥–ª—è SMTP –∏ Bitrix24 –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ Grafana –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∞–ª–µ—Ä—Ç–∞—Ö.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- ‚úÖ –£–∫–∞–∑—ã–≤–∞–π—Ç–µ **—Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã** –≤ `contacts[]` (–Ω–∞–ø—Ä–∏–º–µ—Ä, email –ø–æ—Å–ª–µ bitrix).
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `correlationId` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–æ –¥–æ—Å—Ç–∞–≤–∫–∏.
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ fallback-–∫–∞–Ω–∞–ª—ã (—Ñ–∞–π–ª, –∫–æ–Ω—Å–æ–ª—å) —Ä–∞–±–æ—Ç–∞—é—Ç.
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ `/health/ready` –≤ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–µ (Kubernetes, Docker Swarm –∏ –¥—Ä.).
