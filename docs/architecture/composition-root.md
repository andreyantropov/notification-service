# Composition Root

Composition Root ‚Äî —ç—Ç–æ **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ** –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö, –≥–¥–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –≥–æ—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.  
–û–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø **–∏–Ω–≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –º–æ–¥—É–ª–∏ (use cases) –ø–æ–ª—É—á–∞—é—Ç —Å–≤–æ–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∞ –Ω–µ —Å–æ–∑–¥–∞—é—Ç –∏—Ö –Ω–∞–ø—Ä—è–º—É—é.

> üí° –≠—Ç–æ –Ω–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –∞ **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∫–∞—Ä–∫–∞—Å**, —Å–≤—è–∑—ã–≤–∞—é—â–∏–π `domain`, `application` –∏ `infrastructure`.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- ‚úÖ **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —Å–±–æ—Ä–∫–∏** ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å.
- ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –¥–æ–º–µ–Ω–∞** ‚Äî –Ω–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª, —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–æ–¥–∫–∞.
- ‚úÖ **–õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ, —á—Ç–æ –¥–∞—ë—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø–æ—Ä—è–¥–∫–æ–º.
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî –≤ —Ç–µ—Å—Ç–∞—Ö –ª–µ–≥–∫–æ –ø–æ–¥–º–µ–Ω–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

---

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: Awilix

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [Awilix](https://github.com/jeffijoe/awilix) ‚Äî DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è Node.js:

- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `singleton`, `transient`, `scoped`.
- –†–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ–∞–±—Ä–∏—á–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ (`createXxx`).
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ –∏–ª–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π.

–ü—Ä–∏–º–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

```ts
container.register({
  sendNotificationUseCase: asFunction(
    ({ buffer, deliveryService, logger }) =>
      createSendNotificationUseCase(buffer, deliveryService, logger),
  ).singleton(),
});
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
composition/
‚îú‚îÄ‚îÄ bootstrap/                ‚Üí –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ container/                   ‚Üí –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ lifecycle/                   ‚Üí –ó–∞–ø—É—Å–∫/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
‚îú‚îÄ‚îÄ telemetry/                   ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OpenTelemetry (–¥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
‚îî‚îÄ‚îÄ types/                       ‚Üí –¢–∏–ø—ã

---

## –ü–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

1. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `bootstrap.ts`.
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `lifecycle/start.ts`.
3. **–°–Ω–∞—á–∞–ª–∞** –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è OpenTelemetry (–¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞).
4. **–ó–∞—Ç–µ–º** —Å–æ–∑–¥–∞—ë—Ç—Å—è Awilix-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.
5. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è HTTP-—Å–µ—Ä–≤–µ—Ä –∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –æ—á–µ—Ä–µ–¥–µ–π.

–≠—Ç–æ—Ç –ø–æ—Ä—è–¥–æ–∫ **–∫—Ä–∏—Ç–∏—á–µ–Ω**: —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ **–¥–æ** –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Express, —Ç.–∫. –≤ –µ–µ –æ—Å–Ω–æ–≤–µ –ª–µ–∂–∏—Ç Monkey Patching.

---

## –ö–æ–Ω—Ç—Ä–∞–∫—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ–ø–∏—Å–∞–Ω –≤ —Ç–∏–ø–µ [`Container`](../types/Container.ts).  
–û–Ω –≤–∫–ª—é—á–∞–µ—Ç:

- –°–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ retry,
- Use cases,
- –ö–∞–Ω–∞–ª—ã (Bitrix, Email),
- Middleware,
- –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã (Producer, Consumer, Logger, Tracer, Meter).

---

## –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

- üîå **–ì–∏–±–∫–æ—Å—Ç—å**: –ª–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å –∫–∞–Ω–∞–ª –∏–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é.
- üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ–¥–º–µ–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ DI.
- üßπ **–ß–∏—Å—Ç–æ—Ç–∞**: –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–µ –∑–Ω–∞–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö.
- üìà **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.

> –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –≤ –∫–æ–¥–µ: `src/composition/`.
```