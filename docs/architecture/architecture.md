# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

## –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —á–µ—Ä–µ–∑ Bitrix24 API –∏–ª–∏ Email.  
–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ InfluxDB –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ Grafana.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```src/
‚îú‚îÄ‚îÄ api/ # API
‚îÇ ‚îú‚îÄ‚îÄ openapi/ # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger
‚îÇ ‚îî‚îÄ‚îÄ schemas/ # ZOD-—Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ application/ # –ü—Ä–∏–∫–ª–∞–¥–Ω–æ–π —É—Ä–æ–≤–µ–Ω—å: –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ ‚îî‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ notificationDeliveryService/ # –°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ notificationLoggerService/ # –õ–æ–≥–≥–µ—Ä
‚îÇ ‚îî‚îÄ‚îÄ useCases/ # UseCase'—ã
‚îú‚îÄ‚îÄ composition/ # Composition Root
‚îÇ   ‚îú‚îÄ‚îÄ bootstrap/ # –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ core/ # Singleton'—ã —è–¥—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Å–µ—Ä–≤–∏—Å—ã, use cases)
‚îÇ   ‚îú‚îÄ‚îÄ server/ # Singleton'—ã HTTP-—Å–µ—Ä–≤–µ—Ä–∞ –∏ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ configs/ # –ö–æ–Ω—Ñ–∏–≥–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ domain/ # –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
‚îÇ ‚îî‚îÄ‚îÄ interfaces/ # –ê–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ (–ø–æ—Ä—Ç—ã)
‚îÇ ‚îî‚îÄ‚îÄ types/ # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ infrastructure/ # –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ ‚îî‚îÄ‚îÄ http/ # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ express/
‚îÇ ‚îî‚îÄ‚îÄ senders/ # –ö–∞–Ω–∞–ª—ã —Ä–∞—Å—Å—ã–ª–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ bitrixSender/
‚îÇ   ‚îî‚îÄ‚îÄ smtpSender/
‚îú‚îÄ‚îÄ shared/ # –û–±—â–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ ‚îî‚îÄ‚îÄ enums/
‚îÇ ‚îî‚îÄ‚îÄ infrastructure/
‚îÇ  ‚îî‚îÄ‚îÄ loggers # –õ–æ–≥–≥–µ—Ä—ã
‚îÇ ‚îî‚îÄ‚îÄ interfaces/
‚îÇ ‚îî‚îÄ‚îÄ utils/
‚îî‚îÄ‚îÄ index.ts # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è/Composition Root
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º —Å–ª–µ–¥—É—é—â–∏—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤:

- **Clean Architecture**: —É—Ä–æ–≤–Ω–∏ `domain`, `application`, `api` –∏ `infrastructure` —á—ë—Ç–∫–æ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –æ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
- **KISS (Keep It Simple, Stupid)**: —Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Å —É—á—ë—Ç–æ–º –ø—Ä–æ—Å—Ç–æ—Ç—ã. –°–ª–æ–∂–Ω—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω—ã.
- **DRY (Don't Repeat Yourself)**: –ø–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –ª–æ–≥–∏–∫–∞ –≤—ã–Ω–æ—Å–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `fallbackSender`) –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
- **–ß–∞—Å—Ç–∏—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ SOLID**:
  - **SRP (Single Responsibility Principle)**: –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å —Ä–µ—à–∞–µ—Ç –æ–¥–Ω—É –∑–∞–¥–∞—á—É
  - **OCP (Open/Closed Principle)**: —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –Ω–æ –∑–∞–∫—Ä—ã—Ç–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
  - **DIP (Dependency Inversion Principle)**: –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤–Ω–µ–¥—Ä—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `NotificationSender`)
  - **ISP (Interface Segregation Principle)**: –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ç–æ–¥—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, `Recipients` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —É –∫–ª–∏–µ–Ω—Ç–∞
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å**: —Å–µ—Ä–≤–∏—Å—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–∞—Ä–∞–¥–∏–≥–º–µ ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **—á–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**, **—è–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**, **–º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è**
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: —Å–µ—Ä–≤–∏—Å—ã –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è —è–≤–Ω—ã–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞
- **Fail Fast**: –æ—à–∏–±–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞, —á—Ç–æ–±—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∏—Å–∫–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –Ω–æ–≤—ã–µ —Å–ø–æ—Å–æ–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏, –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–æ—Å—Ç–∞–≤–∫–∏**:
  - –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç–¥–µ–ª–µ–Ω–∞ –æ—Ç —Å–µ—Ä–≤–∏—Å–∞ —á–µ—Ä–µ–∑ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
  - –í–æ–∑–º–æ–∂–Ω–∞ –≥–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–º—É –¥–æ—Å—Ç—É–ø–Ω–æ–º—É", "–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º", "–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É")
  - –ù–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ —Å–µ—Ä–≤–∏—Å–∞
- **Composition Root**:
  - –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
  - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω–∂–µ–∫—Ç—è—Ç—Å—è —á–µ—Ä–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
  - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ "new" –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ

## API —Å–µ—Ä–≤–∏—Å–∞

### –≠–Ω–¥–ø–æ–∏–Ω—Ç `POST /v1/notifications`

–≠–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç HTTP POST –∑–∞–ø—Ä–æ—Å—ã —Å –æ–¥–Ω–∏–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –∏–ª–∏ –º–∞—Å—Å–∏–≤–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

#### –ó–∞–≥–æ–ª–æ–≤–∫–∏:

- `Content-Type: application/json`

#### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ ‚Äî –æ–¥–∏–Ω –∏–∑ –¥–≤—É—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

**1. –û–¥–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:**

```
{
  "recipients": [
    {
      "type": "bitrix",
      "value": 12345
    },
    {
      "type": "email",
      "value": "user@example.com"
    }
  ],
  "message": "–¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
}
```

**2. –ú–∞—Å—Å–∏–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–æ—Ç 1 –¥–æ 100):**

```
[
  {
    "recipients": [
      {
        "type": "email",
        "value": "user1@example.com"
      }
    ],
    "message": "–ü—Ä–∏–≤–µ—Ç, user1!"
  },
  {
    "recipients": [
      {
        "type": "bitrix",
        "value": 67890
      }
    ],
    "message": "–ü—Ä–∏–≤–µ—Ç, user2!"
  }
]
```

> ‚ö†Ô∏è –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ `[]` –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º ‚Äî –≤–µ—Ä–Ω—ë—Ç `400 Bad Request`.

#### –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞:

- `201 Created`: –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã.
- `207 Multi-Status`: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–∞—Å—Ç–∏—á–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã.  
  –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª–∏ –ø–æ –∫–∞–∂–¥–æ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—é:

  ```
  {
    "message": "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–∞—Å—Ç–∏—á–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã",
    "totalCount": 3,
    "successCount": 2,
    "errorCount": 1,
    "details": [
      {
        "status": "success",
        "recipients": [{ "type": "email", "value": "user1@example.com" }]
      },
      {
        "status": "error",
        "recipients": [{ "type": "bitrix", "value": 12345 }]
      }
    ]
  }
  ```

  –ï—Å–ª–∏ **–Ω–∏ –æ–¥–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –±—ã–ª–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ**, —Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç:

  ```
  {
    "message": "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∏ –æ–¥–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
    "totalCount": 2,
    "successCount": 0,
    "errorCount": 2,
    "details": [...]
  }
  ```

- `400 Bad Request`: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (–Ω–µ–≤–∞–ª–∏–¥–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤, –ø—Ä–µ–≤—ã—à–µ–Ω–æ 100 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —Ç.–ø.).
- `500 Internal Server Error`: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–±–æ–π –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ –≤–Ω–µ—à–Ω–µ–º—É —Å–µ—Ä–≤–∏—Å—É).
- `404 Not Found`: –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.
- `429 Too Many Requests`: –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (rate limit).

> üí° **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**:
>
> - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–∞—á–∫–∏ ‚Äî **100 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**.
> - –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–≤–µ—Ä–Ω—ã–π email) –ø—Ä–∏–≤–æ–¥—è—Ç –∫ `400`.
> - –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω push-—Å–µ—Ä–≤–∏—Å) ‚Äî –∫ `207`, –µ—Å–ª–∏ —á–∞—Å—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–æ—à–ª–∞.

---

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (Healthcheck)

#### –≠–Ω–¥–ø–æ–∏–Ω—Ç `GET /health/live`

–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–µ—Ä–≤–∏—Å –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –æ–Ω –Ω–∞ –±–∞–∑–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ.

##### –û—Ç–≤–µ—Ç—ã:

- `200 OK`: –°–µ—Ä–≤–∏—Å –∂–∏–≤ –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã.

##### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

–ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞–º–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Kubernetes) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

---

#### –≠–Ω–¥–ø–æ–∏–Ω—Ç `GET /health/ready`

–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≥–æ—Ç–æ–≤ –ª–∏ —Å–µ—Ä–≤–∏—Å –∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤. –ú–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º (–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –∏ —Ç.–¥.).

##### –û—Ç–≤–µ—Ç—ã:

- `200 OK`: –°–µ—Ä–≤–∏—Å –≥–æ—Ç–æ–≤ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤.
- `503 Service Unavailable`: –°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–≤–∏—Å–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å).

##### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ–≥–æ, –º–æ–∂–Ω–æ –ª–∏ –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ —ç—Ç–æ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–µ—Ä–≤–∏—Å–∞.

---

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É `/docs` –≤ —Ñ–æ—Ä–º–∞—Ç–µ Swagger UI.

---

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ middleware

–í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Å–ª–µ–¥—É—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ middleware:

1. **–õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤** ‚Äî —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ rate limit** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–∞.
3. **–ü–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–∫–∏ 404** ‚Äî –µ—Å–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π HTTP-–æ—Ç–≤–µ—Ç.
4. **–ü–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–∫–∏ 500** ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—â–∏–π –ø–∞–¥–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞.
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–ª–∞ request** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è JSON –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π.

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–°–µ—Ä–≤–∏—Å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–≥–∏–±–∫–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**, –ø–æ–∑–≤–æ–ª—è—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–æ–≤, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏ —Ç.–¥.).

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è **"–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–º—É –¥–æ—Å—Ç—É–ø–Ω–æ–º—É"** (`sendToFirstAvailableStrategy`), –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π:

- –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–≤—ã–π —Ä–∞–±–æ—á–∏–π –∫–∞–Ω–∞–ª –∏–∑ —Å–ø–∏—Å–∫–∞.
- –ï—Å–ª–∏ –∫–∞–Ω–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É.
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–∏ —É–¥–∞—á–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∏–º —Å–ø–æ—Å–æ–±–æ–º.

–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ –∫–∞–Ω–∞–ª ‚Äî 1 (–º–æ–∂–µ—Ç –±—ã—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–æ —Å –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã `retry`).

> –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º", "–ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é", "—Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π") –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥–∞ —Å–µ—Ä–≤–∏—Å–∞.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **–°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (NS)**
   - –û–ø–∏—Å–∞–Ω–∏–µ: –°–µ—Ä–≤–∏—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —á–µ—Ä–µ–∑ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–∞–Ω–∞–ª—ã —Å–≤—è–∑–∏ (Bitrix24, Email). –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø–æ API.
   - –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: TypeScript + Node.js.
   - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
     - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏: `axios`, `nodemailer`, `express`, `@influxdata/influxdb-client`, `dotenv`.
     - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: `eslint`, `prettier`, `vitest`, `ts-node`, `nodemon`.
2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Log)**
   - –û–ø–∏—Å–∞–Ω–∏–µ: –°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞.
   - –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: InfluxDB.
   - –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞: `@influxdata/influxdb-client`.
3. **–ö–∞–Ω–∞–ª—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
   - **Bitrix24**: –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ API Bitrix24.
     - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: `axios`.
   - **SMTP**: –†–µ–∑–µ—Ä–≤–Ω—ã–π –∫–∞–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ –ø–æ—á—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä.
     - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `nodemailer`.

## –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. –í–Ω–µ—à–Ω—è—è —Å—Ö–µ–º–∞

```mermaid
flowchart TB
    subgraph Docker
        Container[–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä notification-service]
    end
    ExternalSystem -->|HTTP POST /notifications| Container
    Container --> Bitrix[(Bitrix24 API)]
    Container --> SMTP[(SMTP —Å–µ—Ä–≤–µ—Ä)]
    Container --> Log[(InfluxDB)]
    Log --> Admin
    Bitrix --> User
    SMTP --> User
```

### 2. –í–Ω–µ—Ç—Ä–µ–Ω–Ω—è—è —Å—Ö–µ–º–∞

```mermaid
graph TD
    subgraph Domain
        INotificationSender[(INotificationSender)]
        ILoggerWriter[(ILoggerWriter)]
        Notification[Notification]
        Recipient[Recipient]
    end
    subgraph Application
        NotificationService[createNotificationService]
        NotificationLoggerClient[createApplicationLogger]
    end
    subgraph Infrastructure
        BitrixClient[bitrixClient]
        SmtpClient[smtpClient]
        InfluxDbLogger[influxDbLogger]
        LocalFileLogger[localFileLogger]
    end
    subgraph Shared
        FallbackLogger[fallbackLogger]
        Retry[retry]
    end
    NotificationLoggerClient -->|uses| ILoggerWriter
    NotificationService -->|uses| INotificationSender
    NotificationService -->|uses| NotificationLoggerClient
    BitrixClient -.->|implements| INotificationSender
    SmtpClient -.->|implements| INotificationSender
    InfluxDbLogger -.->|implements| ILoggerWriter
    LocalFileLogger -.->|implements| ILoggerWriter
    FallbackLogger -->|wraps multiple loggers| ILoggerWriter
    FallbackLogger --> InfluxDbLogger
    FallbackLogger --> LocalFileLogger
    NotificationService -->|DI —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä| BitrixClient
    NotificationService -->|DI —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä| SmtpClient
    NotificationService -->|DI —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä| NotificationLoggerClient
    NotificationLoggerClient -->|DI —á–µ—Ä–µ–∑ fallback| ILoggerWriter
```

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**:
   - –°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (NS) –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º —á–µ—Ä–µ–∑ HTTP-–∑–∞–ø—Ä–æ—Å `POST /notifications`.
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**:
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è NS –ø—Ä–∏–º–µ–Ω—è–µ—Ç **–Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–æ—Å—Ç–∞–≤–∫–∏**.
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è `sendToFirstAvailableStrategy`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∞–Ω–∞–ª—ã.
   - –ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω –∫–∞–Ω–∞–ª –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª ‚Äî –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞.
3. **–û—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É**:
   - –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π NS –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å HTTP 201 Created.
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è (—É—Å–ø–µ—à–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∫–∏, –æ—à–∏–±–∫–∏, —É–¥–∞–ª–µ–Ω–∏—è) –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ InfluxDB –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

## –ú–æ–¥—É–ª—å–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ–±—ã –±—ã—Ç—å –≥–∏–±–∫–æ–π –∏ –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–Ω—Ü–∏–ø –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (`Dependency Injection`) –∏ –ø–∞—Ç—Ç–µ—Ä–Ω **—Ñ–∞–±—Ä–∏–∫**.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞–±—Ä–∏–∫

–î–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ñ–∞–±—Ä–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

–≠—Ç–æ –¥–∞—ë—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- **–ö–ª–∏–µ–Ω—Ç—ã –ª–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å**
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**
- **–£–¥–æ–±—Å—Ç–≤–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** ‚Äî –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –º–æ–∫–Ω—É—Ç—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–ü—Ä–∏–º–µ—Ä:

```ts
const sender = getSenderInstance(bitrixConfig, smtpConfig, onError);
const logger = getLoggerInstance(influxDbLoggerConfig);
```

---

## –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è (Docker)

–°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (`notification-service`) –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞, –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ–±—Ä–∞–∑ –∫–∞–∫ –≤ development-, —Ç–∞–∫ –∏ –≤ production-—Å—Ä–µ–¥–µ.

### 1. –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞

–û–±—Ä–∞–∑ —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ `node:23.x` –∏ –≤–∫–ª—é—á–∞–µ—Ç:

- –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TypeScript –∫–æ–¥ (`dist/`)
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`node_modules`)
- –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ —Å–∞–º –æ–±—Ä–∞–∑, –Ω–æ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ)

–ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã —Å–±–æ—Ä–∫–∏:

```bash
docker build -t notification-service .
```

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

- **–ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑**: `node:23.11.0`
- **–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è**: `/app`
- **–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞**: `npm run start` (–¥–ª—è production)
- **–ü–æ—Ä—Ç—ã**: –Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é, —Ç.–∫. —Å–µ—Ä–≤–∏—Å –Ω–µ –∏–º–µ–µ—Ç HTTP-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**: –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–∞–π–ª `.env` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- **–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤ production, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 3. –†–µ–∂–∏–º—ã –∑–∞–ø—É—Å–∫–∞

#### Production-—Ä–µ–∂–∏–º

–í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —É–∂–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (`dist/index.js`). –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `.env`.

```bash
docker run -d \
  --name notification-service \
  --env-file ../.env \
  -p "$PORT:$PORT" \
  notification-service
```

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `run.sh`, –∫–æ—Ç–æ—Ä—ã–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á–∏—Å—Ç—ã–π –∑–∞–ø—É—Å–∫.

> –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

#### Development-—Ä–µ–∂–∏–º

–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `npm run dev` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º.

```bash
docker run -it --rm \
  --name notification-service-dev \
  --env-file ../.env.dev \
  -v $(pwd)/src:/app/src \
  -v $(pwd)/package.json:/app/package.json \
  -v $(pwd)/tsconfig.json:/app/tsconfig.json \
  -w /app \
  node:23.11.0 \
  npm run dev
```

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏:
| –°–∏—Å—Ç–µ–º–∞ | –¢–∏–ø –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è | –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è |
| ----------------- | ------------------ | -------------------- |
| Bitrix24 REST API | HTTP-–∑–∞–ø—Ä–æ—Å—ã | BITRIX\_\* |
| SMTP-—Å–µ—Ä–≤–µ—Ä | –û—Ç–ø—Ä–∞–≤–∫–∞ email | SMTP\_\* |
| InfluxDB | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ | INFLUXDB\_\* |

### 5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Å–∫—Ä–∏–ø—Ç—ã:
| –°–∫—Ä–∏–ø—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| ------------ | ------------------------------------- |
| `build.sh` | –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ |
| `run.sh` | –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ production-—Ä–µ–∂–∏–º–µ |
| `stop.sh` | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |
| `restart.sh` | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |
| `logs.sh` | –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |
| `status.sh` | –ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ InfluxDB —Å —Ç–∞–∫–∏–º–∏ –ø–æ–ª—è–º–∏:

- `measurement`: notification_service_logs
- `timestamp`: –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
- `tags`:
  - `level`: info, warning, error, critical
  - `currentService`: notification-service
  - `callerService`: –∏–º—è —Å–µ—Ä–≤–∏—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  - `trigger`: api, cron, manual
  - `environment`: dev, stage, prod
  - `eventType`: send_bitrix_notification, send_smtp_notification, db_query_error
  - `host`: –∏–º—è —Ö–æ—Å—Ç–∞, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ
  - `traceId`: id —Ç—Ä–µ–π—Å–∞
  - `correlationId`: id —Å–æ–±—ã—Ç–∏—è –≤ —Ä–∞–º–∫–∞—Ö —Ç—Ä–µ–π—Å–∞
  - `spanId`: —ç—Ç–∞–ø, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–∏–∑–æ—à–ª–æ —Å–æ–±—ã—Ç–∏–µ
- `fields`:
  - `id`: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–æ–±—ã—Ç–∏—è
  - `message`: —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - `durationMs`: –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏
  - `payload`: –¥–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - `error`: –µ—Å–ª–∏ –±—ã–ª–∞ –æ—à–∏–±–∫–∞

–ì—Ä–∞—Ñ–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ Grafana.

## –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

–°–µ—Ä–≤–∏—Å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–∞ —Ä–∞–±–æ—Ç—É –≤ —É—Å–ª–æ–≤–∏—è—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å–±–æ–µ–≤:
| –°—Ü–µ–Ω–∞—Ä–∏–π | –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è |
| -------------------------------- | ----------------------------------- |
| Bitrix24 API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∫–∞–Ω–∞–ª ‚Äî SMTP |
| SMTP –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –æ—à–∏–±–∫–∞ |
| InfluxDB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback-–ª–æ–≥–≥–µ—Ä –≤ —Ñ–∞–π–ª |
| –§–∞–π–ª –ª–æ–≥–æ–≤ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø–∏—Å–∞–Ω | –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å |

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –ø–æ—ç—Ç–æ–º—É —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

- **HTTPS –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API**: –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Bitrix24 –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞—â–∏—â—ë–Ω–Ω–æ–µ HTTPS-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.
- **–ó–∞—â–∏—Ç–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ `.env`**: –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (SMTP-–ª–æ–≥–∏–Ω—ã, –≤–µ–±—Ö—É–∫–∏ Bitrix24 –∏ —Ç.–¥.) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤–æ –≤–Ω–µ—à–Ω–µ–º —Ñ–∞–π–ª–µ `.env`, –Ω–µ –ø–æ–ø–∞–¥–∞—é—â–µ–º –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SMTP**:
  - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ TLS/SSL.
  - –•—Ä–∞–Ω–µ–Ω–∏–µ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö ‚Äî —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

> _–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ_: –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è, –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Vault –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Ä–µ—à–µ–Ω–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–∞–º–∏.

## –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å —è–≤–ª—è–µ—Ç—Å—è stateless –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Docker Swarm –∏–ª–∏ Kubernetes), –ø—Ä–∏ —ç—Ç–æ–º –∫–∞–∂–¥—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é —á–∞—Å—Ç—å –æ—á–µ—Ä–µ–¥–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

### –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏** (Telegram, SMS –∏ –¥—Ä.) –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø—É—Ç—ë–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `NotificationSender`.
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è** –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –Ω–æ–≤—ã–µ —Å–ø–æ—Å–æ–±—ã –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ Fallback Pattern.
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–æ—Å—Ç–∞–≤–∫–∏**:
  - –ü–æ–≤–µ–¥–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å, –ø–µ—Ä–µ–¥–∞–≤ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–∞.
  - –ù–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –≤–Ω–µ–¥—Ä—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `strategy` –≤ `createNotificationDeliveryService` –ø—É—Ç—ë–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `DeliveryStrategy`.

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —à–∏–Ω–æ–π –¥–∞–Ω–Ω—ã—Ö (message broker) –ø–æ–∑–≤–æ–ª–∏—Ç –ø–µ—Ä–µ–π—Ç–∏ –∫ –±–æ–ª–µ–µ –≥–∏–±–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è Web UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞–º–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏.

## Use Cases / –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

> –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–æ–≤—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —Å–µ—Ä–≤–∏—Å —É—á–∞—Å—Ç–≤—É–µ—Ç –∫–∞–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã ISPlanar.
> | ‚Ññ | –°—Ü–µ–Ω–∞—Ä–∏–π | –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ |
> | --- | ------------------------------------- | ------------------------------------------------------------------------------------------------------------------ |
> | 1 | **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ** | –°–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ, —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ —á–µ—Ä–µ–∑ Bitrix24 –∏–ª–∏ Email. |
> | 2 | **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏** | –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–í —Ä–∞–±–æ—Ç–µ" ‚Üí "–í—ã–ø–æ–ª–Ω–µ–Ω–∞") –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. |
> | 3 | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏** | –ü–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. |
> | 4 | **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞** | –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º. |
> | 5 | **–†–µ–∑–µ—Ä–≤–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Email** | –ï—Å–ª–∏ Bitrix24 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ SMTP. |

## Composition Root

–≠—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã. –ó–¥–µ—Å—å:

1. –°–æ–∑–¥–∞—é—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
2. –ò–Ω–∂–µ–∫—Ç—è—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏

### –ü—Ä–∏–Ω—Ü–∏–ø—ã:

- **–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ —Å–±–æ—Ä–∫–∏** ‚Äî –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å
- **–ò–Ω–≤–µ—Ä—Å–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** ‚Äî –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –º–æ–¥—É–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- **–ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏** ‚Äî –∫–æ–¥ Composition Root –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:

```typescript
// composition/server/server.ts
export const createDefaultServer = () => {
  // 1. –°–æ–∑–¥–∞–µ–º –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã
  const bitrixSender = createBitrixSender(config);
  const smtpSender = createSmtpSender(config);

  // 2. –°–æ–±–∏—Ä–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã
  const logger = createLogger();
  const fallbackSender = createFallbackSender([bitrixSender, smtpSender]);

  // 3. –°–æ–∑–¥–∞–µ–º use case
  const useCase = createSendNotificationUseCase({
    sender: fallbackSender,
    logger,
  });

  // 4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≥–æ—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä
  return createExpressServer(useCase);
};
```

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:

```mermaid
flowchart TB
    subgraph CompositionRoot
        direction LR
        A[–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã] --> B[–°–µ—Ä–≤–∏—Å—ã]
        B --> C[Use Cases]
        C --> D[API]
    end

    Domain -->|–†–µ–∞–ª–∏–∑—É–µ—Ç| CompositionRoot
    Application -->|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç| CompositionRoot
    Infrastructure -->|–ü–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤| CompositionRoot
```
