# üêá RabbitMQ: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ —Å–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **RabbitMQ** –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ–π, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ—Å—Ä–æ—á–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫**.

## –û–±–∑–æ—Ä

–°–µ—Ä–≤–∏—Å:

- **–ü—É–±–ª–∏–∫—É–µ—Ç** –Ω–µ—Å—Ä–æ—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å `notifications` —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `"x-retry-count": 0`.
- **–ü–æ—Ç—Ä–µ–±–ª—è–µ—Ç** –∏—Ö —á–µ—Ä–µ–∑ `BatchConsumer`, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–∞–∫ **–±–∞—Ç—á-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫**.
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚Äî **–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å `retry-router`**.
- –û—Ç–¥–µ–ª—å–Ω—ã–π **`RetryConsumer`** —á–∏—Ç–∞–µ—Ç –∏–∑ `retry-router`, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
  - –≤ `retry-1` (–∑–∞–¥–µ—Ä–∂–∫–∞ 30 –º–∏–Ω—É—Ç),
  - –≤ `retry-2` (–∑–∞–¥–µ—Ä–∂–∫–∞ 2 —á–∞—Å–∞),
  - –∏–ª–∏ –≤ `dlq` (–ø–æ—Å–ª–µ 2 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫).

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É** —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º.

---

## –¢–æ–ø–æ–ª–æ–≥–∏—è –æ—á–µ—Ä–µ–¥–µ–π

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ø—è—Ç—å –æ—á–µ—Ä–µ–¥–µ–π –∏ –æ–¥–∏–Ω exchange –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**:

| –≠–ª–µ–º–µ–Ω—Ç         | –¢–∏–ø     | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                               |
| --------------- | ------- | -------------------------------------------------------- |
| `notifications` | –æ—á–µ—Ä–µ–¥—å | –û—Å–Ω–æ–≤–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π               |
| `retry-router`  | –æ—á–µ—Ä–µ–¥—å | –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ retry            |
| `retry-1`       | –æ—á–µ—Ä–µ–¥—å | –ó–∞–¥–µ—Ä–∂–∫–∞ 30 –º–∏–Ω—É—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –≤ `notifications`            |
| `retry-2`       | –æ—á–µ—Ä–µ–¥—å | –ó–∞–¥–µ—Ä–∂–∫–∞ 2 —á–∞—Å–∞ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –≤ `notifications`              |
| `dlq`           | –æ—á–µ—Ä–µ–¥—å | Dead Letter Queue –¥–ª—è –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π |

> ‚öôÔ∏è –í—Å–µ –æ—á–µ—Ä–µ–¥–∏ –æ–±—ä—è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (`npm run migrate:prod`) –∏ —è–≤–ª—è—é—Ç—Å—è **durable**.

### –°–≤—è–∑–∏ –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

- **`notifications`** ‚Üí –ø—Ä–∏ `nack(false, false)` ‚Üí **`retry-router`**  
  (—á–µ—Ä–µ–∑ DLX: `"x-dead-letter-routing-key": "retry-router"`)
- **`retry-router`** ‚Üí —á–∏—Ç–∞–µ—Ç **`RetryConsumer`**, –∫–æ—Ç–æ—Ä—ã–π:
  - —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `"x-retry-count"`,
  - –ø—É–±–ª–∏–∫—É–µ—Ç –≤ `retry-1`, `retry-2` –∏–ª–∏ `dlq` —á–µ—Ä–µ–∑ **default exchange**.
- **`retry-1`** ‚Üí –ø–æ—Å–ª–µ TTL (30 –º–∏–Ω) ‚Üí **`notifications`**  
  (—á–µ—Ä–µ–∑ DLX: `"x-dead-letter-routing-key": "notifications"`)
- **`retry-2`** ‚Üí –ø–æ—Å–ª–µ TTL (2 —á) ‚Üí **`notifications`**
- **`dlq`** ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å, –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

> üí° –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ **–º–∞–∫—Å–∏–º—É–º 3 —Ä–∞–∑–∞**:  
> –ø–æ–ø—ã—Ç–∫–∞ 0 ‚Üí retry-1 ‚Üí –ø–æ–ø—ã—Ç–∫–∞ 1 ‚Üí retry-2 ‚Üí –ø–æ–ø—ã—Ç–∫–∞ 2 ‚Üí dlq.

---

## –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî —ç—Ç–æ JSON-—Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `Notification`.  
–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–∑–∞–≥–æ–ª–æ–≤–∫–∏ (headers)** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è retry:

| –ó–∞–≥–æ–ª–æ–≤–æ–∫                  | –¢–∏–ø       | –û–ø–∏—Å–∞–Ω–∏–µ                                                    |
| -------------------------- | --------- | ----------------------------------------------------------- |
| `x-retry-count`            | `number`  | –¢–µ–∫—É—â–∏–π –Ω–æ–º–µ—Ä –ø–æ–ø—ã—Ç–∫–∏ (0 ‚Äî –ø–µ—Ä–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞)                 |
| `x-unexpected-retry-count` | `number`  | –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ —Å—á—ë—Ç—á–∏–∫–∞ |
| `x-retry-consumer-failure` | `boolean` | –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –æ—à–∏–±–∫—É –≤ `RetryConsumer`                       |

–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:

```json
{
  "id": "notif-123",
  "contacts": [{ "type": "email", "value": "user@example.com" }],
  "message": "–í–∞—à –∑–∞–∫–∞–∑ –æ–±—Ä–∞–±–æ—Ç–∞–Ω",
  "isImmediate": false
}
```

---

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. `BatchConsumer` (–æ—Å–Ω–æ–≤–Ω–æ–π)

- –ß–∏—Ç–∞–µ—Ç –∏–∑ **`notifications`**.
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `nack(false, false)`.
- **–ù–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç retry** ‚Äî –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç —ç—Ç–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ RabbitMQ.
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (`ack`).

### 2. `RetryConsumer` (—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

- –ß–∏—Ç–∞–µ—Ç –∏–∑ **`retry-router`**.
- **–ù–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–Ω–µ—à–Ω—é—é –ª–æ–≥–∏–∫—É** ‚Äî –µ–≥–æ –∑–∞–¥–∞—á–∞ ‚Äî —Ç–æ–ª—å–∫–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è.
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `x-retry-count` –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:
  - `count=0` ‚Üí `retry-1`
  - `count=1` ‚Üí `retry-2`
  - `count‚â•2` ‚Üí `dlq`
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ `dlq` —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏.

### 3. –û—á–µ—Ä–µ–¥–∏ `retry-1` / `retry-2`

- **–ù–µ –∏–º–µ—é—Ç consumer‚Äô–æ–≤**.
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç **TTL + DLX** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ `notifications`.

---

## –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Ç–æ–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

```mermaid
flowchart TD
    A[Producer] -->|x-retry-count: 0| B(notifications)
    B -->|—É—Å–ø–µ—à–Ω–æ| C[Ack]
    B -->|–æ—à–∏–±–∫–∞ ‚Üí nack| D[retry-router]
    D --> E[RetryConsumer]
    E -->|count=0| F[retry-1\nTTL=30m]
    E -->|count=1| G[retry-2\nTTL=2h]
    E -->|count‚â•2| H[dlq]
    F -->|TTL –∏—Å—Ç—ë–∫| B
    G -->|TTL –∏—Å—Ç—ë–∫| B
    H --> I[–ê–Ω–∞–ª–∏–∑/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ]
```

---

## –ú–∏–≥—Ä–∞—Ü–∏–∏

–¢–æ–ø–æ–ª–æ–≥–∏—è —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º `setupRabbitMQ.ts`:

```bash
npm run migrate:dev    # development
npm run migrate:prod   # production
```

–°–∫—Ä–∏–ø—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω –∏ –æ–±—ä—è–≤–ª—è–µ—Ç –≤—Å–µ 5 –æ—á–µ—Ä–µ–¥–µ–π —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏:

- `x-message-ttl` –¥–ª—è `retry-1` –∏ `retry-2`,
- `x-dead-letter-*` –¥–ª—è –≤—Å–µ—Ö –æ—á–µ—Ä–µ–¥–µ–π.

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ observability

- –í—Å–µ —ç—Ç–∞–ø—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ `eventType`:
  - `Bootstrap`, `Shutdown` ‚Äî –∑–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ consumer‚Äô–æ–≤,
  - `MessageConsume` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–µ–π,
  - `HealthCheck` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ RabbitMQ.
- **DLQ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∫ –∞–ª–µ—Ä—Ç–∏–Ω–≥—É** (Telegram).
- –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ—Å—É—Ç `traceId`/`spanId` —á–µ—Ä–µ–∑ OpenTelemetry (–µ—Å–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ publisher/consumer).

---

## –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã —Ä–∞–∑–≤–∏—Ç–∏—è

–í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `RetryConsumer` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ —á–∞—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. –û–¥–Ω–∞–∫–æ –≤ –±—É–¥—É—â–µ–º –µ–≥–æ –º–æ–∂–Ω–æ **–≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å**, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç:

- **–û–±—â–∏–º –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é —Å—Ö–µ–º—É retry —Å RabbitMQ.
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ**, —É—á–∏—Ç—ã–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é.
- **–£–ø—Ä–æ—â–∞—Ç—å —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ** –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ ‚Äî –∏–º –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å retry-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.
- **–û–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é observability** –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏.

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ —É—Å–∏–ª–∏—Ç –ø—Ä–∏–Ω—Ü–∏–ø **—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –±–∏–∑–Ω–µ—Å-—Å–µ—Ä–≤–∏—Å—ã —Ñ–æ–∫—É—Å–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Å–≤–æ–µ–π –ª–æ–≥–∏–∫–µ, –∞ retry-–º–µ—Ö–∞–Ω–∏–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–∞—Å—Ç—å—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ —Å–ª–æ—è.

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

‚úÖ **–ù–µ—Ç –ø–æ—Ç–µ—Ä—å —Å–æ–æ–±—â–µ–Ω–∏–π** ‚Äî –≤—Å–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è.  
‚úÖ **–≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º.  
‚úÖ **–ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**:

- `BatchConsumer` ‚Äî —Ç–æ–ª—å–∫–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞,
- `RetryConsumer` ‚Äî —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è.  
  ‚úÖ **–õ—ë–≥–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ** ‚Äî –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `retry-3`, –∏–∑–º–µ–Ω–∏—Ç—å TTL –∏ —Ç.–ø. –±–µ–∑ –ø—Ä–∞–≤–æ–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥–µ.
