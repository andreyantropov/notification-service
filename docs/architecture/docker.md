# Docker: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (`notification-service`) –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –º–µ–∂–¥—É –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏ (dev, staging, prod).
- –ò–∑–æ–ª—è—Ü–∏—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
- –ü—Ä–æ—Å—Ç–æ—Ç—É —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.
- –ü–æ–¥–¥–µ—Ä–∂–∫—É CI/CD –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Kubernetes).

---

## –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞

–û–±—Ä–∞–∑ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ `node:23.11.0-alpine` –∏ –≤–∫–ª—é—á–∞–µ—Ç:

- –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TypeScript-–∫–æ–¥ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `dist/`.
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`node_modules`).
- –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `npm run start` (production-—Ä–µ–∂–∏–º).

> üí° –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è **–Ω–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ –æ–±—Ä–∞–∑**, –∞ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.

### –°–±–æ—Ä–∫–∞ (—á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç)

```bash
./build.sh
```

> –û–±—Ä–∞–∑ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω —Å –∏–º–µ–Ω–µ–º `notification-service` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–≥ `latest`).

> üí° –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–±–æ—Ä–∫—É –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ (`..`), –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è `Dockerfile`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –µ–≥–æ –∏–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –ø–∞–ø–∫–∏ `scripts/`).

### –°–±–æ—Ä–∫–∞ (–≤—Ä—É—á–Ω—É—é)

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –≤—Ä—É—á–Ω—É—é, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
docker build -t notification-service .
```

> ‚ö†Ô∏è –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è `Dockerfile`.

---

## –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±)

### Production-—Ä–µ–∂–∏–º

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`) –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π –ø–æ—Ä—Ç–∞.

#### –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
./run.sh
```

> ‚úÖ –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
>
> - –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å).
> - –ó–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—ã–π —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.
> - –ü–æ–¥–∫–ª—é—á–∞–µ—Ç `.env` –∏ –ø—É–±–ª–∏–∫—É–µ—Ç –ø–æ—Ä—Ç.

> ‚ö†Ô∏è –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `.env` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.

---

## –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ CI/CD)

–•–æ—Ç—è –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —É–¥–æ–±–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã, –ø–æ–ª–µ–∑–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è:

- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–æ–≤.
- –û—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å–æ —Å–±–æ—Ä–∫–æ–π –∏–ª–∏ –∑–∞–ø—É—Å–∫–æ–º.
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏ (Kubernetes, Docker Compose).

### –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é

```bash
docker run -d \
  --name notification-service \
  --env-file .env \
  -p "$PORT:$PORT" \
  notification-service
```

> üí° –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `$PORT` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ –æ–±–æ–ª–æ—á–∫–µ –∏–ª–∏ –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `3000`).

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ

```bash
docker stop notification-service
docker rm notification-service
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç—ã, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É—é—â–∏–µ —Ç–∏–ø–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:

| –°–∫—Ä–∏–ø—Ç       | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                            |
| ------------ | ------------------------------------- |
| `build.sh`   | –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞                  |
| `run.sh`     | –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ production-—Ä–µ–∂–∏–º–µ |
| `stop.sh`    | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞       |
| `restart.sh` | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞                 |
| `logs.sh`    | –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤                        |
| `status.sh`  | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞           |

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
docker logs notification-service
```

–í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

```bash
docker logs -f notification-service
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                | –û–ø–∏—Å–∞–Ω–∏–µ                                                     |
| ------------------------ | ------------------------------------------------------------ |
| **–ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑**        | `node:23.11.0-alpine`                                        |
| **–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è**   | `/app`                                                       |
| **–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞**          | `npm run start` (production), `npm run dev` (development)    |
| **–ü–æ—Ä—Ç—ã**                | –ü—É–±–ª–∏–∫—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `-p $PORT:$PORT` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `3000`)     |
| **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** | –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `--env-file .env`                           |
| **–¢–æ–º–∞ (volumes)**       | –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ dev-—Ä–µ–∂–∏–º–µ –¥–ª—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ |

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –°–∏—Å—Ç–µ–º–∞           | –¢–∏–ø –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è | –ö–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è                                       |
| ----------------- | ------------------ | ------------------------------------------------------------------- |
| Bitrix24 REST API | HTTP-–∑–∞–ø—Ä–æ—Å—ã       | `BITRIX_BASE_URL`, `BITRIX_TOKEN`                                   |
| SMTP-—Å–µ—Ä–≤–µ—Ä       | –û—Ç–ø—Ä–∞–≤–∫–∞ email     | `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASS`                  |
| InfluxDB          | –ó–∞–ø–∏—Å—å –º–µ—Ç—Ä–∏–∫      | `INFLUXDB_URL`, `INFLUXDB_TOKEN`, `INFLUXDB_ORG`, `INFLUXDB_BUCKET` |

> üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–±—Ä–∞–∑–µ** ‚Äî –æ–Ω–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã (`run.sh`, `stop.sh`) –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ ‚Äî –æ–Ω–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç —á–∏—Å—Ç–æ—Ç—É –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å.
- ‚úÖ –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `.env` —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω.
- ‚ùå –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.env.example` –¥–ª—è —à–∞–±–ª–æ–Ω–∞.
- üîÑ –í CI/CD ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã `docker build` –∏ `docker run`, –∞–¥–∞–ø—Ç–∏—Ä—É—è –∏—Ö –ø–æ–¥ –≤–∞—à –ø–∞–π–ø–ª–∞–π–Ω.
- üõ°Ô∏è –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç–∞–º –∏ —Å–µ—Ç–µ–≤—ã–º –ø–æ–ª–∏—Ç–∏–∫–∞–º –≤ production.
- üì¶ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ (—Ç–µ–≥–æ–≤) –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±—É–¥—É—â–µ–º ‚Äî —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏.
