# Docker: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (`notification-service`) –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –º–µ–∂–¥—É –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏ (dev, staging, prod).
- –ò–∑–æ–ª—è—Ü–∏—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
- –ü—Ä–æ—Å—Ç–æ—Ç—É —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.
- –ü–æ–¥–¥–µ—Ä–∂–∫—É CI/CD –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Kubernetes).

---

## –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞

–û–±—Ä–∞–∑ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ `node:23.11.0-alpine` –∏ –≤–∫–ª—é—á–∞–µ—Ç:

- –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TypeScript-–∫–æ–¥ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `dist/`.
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ production-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`node_modules`).
- –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `entrypoint.sh`.

> üí° –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è **–Ω–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ –æ–±—Ä–∞–∑**, –∞ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.

### –°–±–æ—Ä–∫–∞ (—á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç)

```bash
./build.sh
```

> –û–±—Ä–∞–∑ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω —Å –∏–º–µ–Ω–µ–º `notification-service` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–≥ `latest`).

### –°–±–æ—Ä–∫–∞ (–≤—Ä—É—á–Ω—É—é)

```bash
docker build -t notification-service .
```

> ‚ö†Ô∏è –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è `Dockerfile`.

---

## –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–º–∏–≥—Ä–∞—Ü–∏–∏**, –ø–æ—Å–ª–µ —á–µ–≥–æ —Å—Ç–∞—Ä—Ç—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `entrypoint.sh`

```sh
#!/bin/sh
echo "–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏..."
npm run migrate:prod

echo "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è..."
npm run start
```

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ:

- –û—á–µ—Ä–µ–¥–∏ RabbitMQ (`notifications`, `retry-1`, `retry-2`, `dlq`) —Å–æ–∑–¥–∞–Ω—ã –¥–æ —Å—Ç–∞—Ä—Ç–∞ consumer‚Äô–∞.
- –°–µ—Ä–≤–∏—Å –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Ç–æ–ª—å–∫–æ –Ω–∞ –≥–æ—Ç–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ.

> üí° –ú–∏–≥—Ä–∞—Ü–∏–∏ **–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã** ‚Äî –∏—Ö –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.

### –ó–∞–ø—É—Å–∫ (—á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç)

```bash
./run.sh
```

> ‚úÖ –°–∫—Ä–∏–ø—Ç:
>
> - –ü–æ–¥–∫–ª—é—á–∞–µ—Ç `.env`,
> - –ü—É–±–ª–∏–∫—É–µ—Ç –ø–æ—Ä—Ç,
> - –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏–π.

### –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é

```bash
docker run -d \
  --name notification-service \
  --env-file .env \
  -p "$PORT:$PORT" \
  notification-service
```

> üí° –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `$PORT` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ –æ–±–æ–ª–æ—á–∫–µ –∏–ª–∏ –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `3000`).

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

| –°–∫—Ä–∏–ø—Ç       | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                      |
| ------------ | ------------------------------- |
| `build.sh`   | –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞            |
| `run.sh`     | –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞               |
| `stop.sh`    | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |
| `restart.sh` | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞           |
| `logs.sh`    | –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤                  |
| `status.sh`  | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞     |

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                | –û–ø–∏—Å–∞–Ω–∏–µ                                                    |
| ------------------------ | ----------------------------------------------------------- |
| **–ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑**        | `node:23.11.0-alpine`                                       |
| **–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è**   | `/app`                                                      |
| **–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞**          | `/entrypoint.sh` ‚Üí `npm run migrate:prod` ‚Üí `npm run start` |
| **–ü–æ—Ä—Ç—ã**                | –ü—É–±–ª–∏–∫—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `-p $PORT:$PORT` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `3000`)    |
| **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** | –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `--env-file .env`                          |

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏:

| –°–∏—Å—Ç–µ–º–∞      | –¢–∏–ø –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è | –ö–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è                                       |
| ------------ | ------------------ | ------------------------------------------------------------------- |
| **RabbitMQ** | AMQP               | `RABBIT_URL`                                                        |
| **Bitrix24** | HTTP API           | `BITRIX_BASE_URL`, `BITRIX_API_TOKEN`                               |
| **SMTP**     | Email              | `SMTP_HOST`, `SMTP_PORT`, `SMTP_LOGIN`, `SMTP_PASSWORD`             |
| **InfluxDB** | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ        | `INFLUXDB_URL`, `INFLUXDB_TOKEN`, `INFLUXDB_ORG`, `INFLUXDB_BUCKET` |

> üîê –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `.env` ‚Äî **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–±—Ä–∞–∑–µ**.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `./run.sh` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ ‚Äî –æ–Ω –≤–∫–ª—é—á–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏.
- ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ **RabbitMQ** ‚Äî –±–µ–∑ –Ω–µ–≥–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∑–∞–ø—É—Å–∫ —É–ø–∞–¥—É—Ç.
- ‚ùå –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.env.example`.
- üîÑ –í CI/CD ‚Äî –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ RabbitMQ –∏ –¥—Ä—É–≥–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ã (healthcheck).
- üì¶ –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ–≥–∏ –æ–±—Ä–∞–∑–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `v3.0.0`), –∞ –Ω–µ `latest`.
