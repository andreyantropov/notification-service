# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—É—é –≤–∏–¥–∏–º–æ—Å—Ç—å —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –≤—ã—è–≤–ª—è—Ç—å –∏ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã, –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ InfluxDB

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ **InfluxDB** ‚Äî –≤—Ä–µ–º–µ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–æ–≤.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø–∏—Å–∏

| –ü–æ–ª–µ            | –¢–∏–ø           | –û–ø–∏—Å–∞–Ω–∏–µ                                   |
| --------------- | ------------- | ------------------------------------------ |
| **measurement** | string        | –ò–º—è –∏–∑–º–µ—Ä–µ–Ω–∏—è: `notification_service_logs` |
| **timestamp**   | datetime      | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è (UTC)              |
| **tags**        | –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º—ã–µ, –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏) |
| **fields**      | –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ | –î–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–Ω–µ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º—ã–µ)           |

---

### Tags (–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)

| –¢–µ–≥              | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                  |
| ---------------- | ----------------------------------------------------------------------------------------- |
| `level`          | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∞: `info`, `warning`, `error`, `critical`                                      |
| `currentService` | –ò–º—è —Ç–µ–∫—É—â–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞: `notification-service`                                              |
| `callerService`  | –ò–º—è —Å–µ—Ä–≤–∏—Å–∞, –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–≤—à–µ–≥–æ –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è                                         |
| `trigger`        | –ò—Å—Ç–æ—á–Ω–∏–∫ —Å–æ–±—ã—Ç–∏—è: `api`, `cron`, `manual`                                                 |
| `environment`    | –û–∫—Ä—É–∂–µ–Ω–∏–µ: `dev`, `stage`, `prod`                                                         |
| `eventType`      | –¢–∏–ø —Å–æ–±—ã—Ç–∏—è: `send_bitrix_notification`, `send_smtp_notification`, `db_query_error` –∏ –¥—Ä. |
| `host`           | –ò–º—è —Ö–æ—Å—Ç–∞ –∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞                                                                  |
| `traceId`        | ID —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ç—Ä–µ–π—Å–∞ (–¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –ª–æ–≥–æ–≤)                                          |
| `correlationId`  | ID –±–∏–∑–Ω–µ—Å-—Å–æ–±—ã—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, ID –∑–∞–∫–∞–∑–∞)                                                   |
| `spanId`         | ID —ç—Ç–∞–ø–∞ –≤ —Ä–∞–º–∫–∞—Ö —Ç—Ä–µ–π—Å–∞                                                                  |

---

### Fields (–Ω–µ–ª–∏–Ω–µ–π–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

| –ü–æ–ª–µ         | –û–ø–∏—Å–∞–Ω–∏–µ                                         |
| ------------ | ------------------------------------------------ |
| `id`         | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–æ–±—ã—Ç–∏—è                            |
| `message`    | –¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏) |
| `durationMs` | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö            |
| `payload`    | –ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—Ä–µ–∑–∞–Ω)   |
| `error`      | –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)                  |

---

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Fallback-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è)

–î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è **"–ª–æ–≥–≥–∏—Ä—É–π, —á–µ–º –º–æ–∂–µ—à—å"**:

1. **–û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–±**: –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ InfluxDB.
2. **–†–µ–∑–µ—Ä–≤–Ω—ã–π —Å–ø–æ—Å–æ–±**: –µ—Å–ª–∏ InfluxDB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –∑–∞–ø–∏—Å—å –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª `.log`.
3. **–§–∏–Ω–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±**: –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –≤—ã–≤–æ–¥ –≤ `stdout` (–∫–æ–Ω—Å–æ–ª—å).

> ‚úÖ –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ **–Ω–∏ –æ–¥–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ –Ω–µ –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω–æ** –¥–∞–∂–µ –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –æ—Ç–∫–∞–∑–µ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º.

---

## –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ Grafana

–ì—Ä–∞—Ñ–∏–∫–∏ –∏ –¥–∞—à–±–æ—Ä–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ **Grafana**. –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞–Ω–µ–ª–∏:

- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º** (`level`): —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ `info` / `warning` / `error`.
- **–û–±—â–∏–π –ø–æ—Ç–æ–∫ –ª–æ–≥–æ–≤**: –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ.
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—é**: –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –¥–ª—è `error`, `warning` –∏ —Ç.–¥.
- **–ü–æ–∏—Å–∫ –ø–æ `callerService` –∏ `correlationId`**: –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Å–∫–≤–æ–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

> üîó URL Grafana: `http://192.168.6.191:3000`

---

## –ê–ª–µ—Ä—Ç–∏–Ω–≥

–î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞:

- **–£—Ä–æ–≤–Ω–∏ `error` –∏ `critical`** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –∞–ª–µ—Ä—Ç.
- –ê–ª–µ—Ä—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ **Telegram** —á–µ—Ä–µ–∑ –±–æ—Ç–∞.
- –í —Å–æ–æ–±—â–µ–Ω–∏–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è:
  - –£—Ä–æ–≤–µ–Ω—å
  - `eventType`
  - `correlationId` / `traceId`
  - –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
  - –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –¥–∞—à–±–æ—Ä–¥ –≤ Grafana (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)

> ‚ö†Ô∏è –ê–ª–µ—Ä—Ç–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω —Ç–æ–ª—å–∫–æ –≤ **production-–æ–∫—Ä—É–∂–µ–Ω–∏–∏**.  
> –í `dev` –∏ `stage` ‚Äî —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- ‚úÖ –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ `callerService` –∏ `correlationId` ‚Äî —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.
- ‚úÖ –ù–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–∞—Ä–æ–ª–∏, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ) –≤ `payload`.
- üìà –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Alertmanager –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–ª–µ—Ä—Ç–∞–º–∏.
- üõ† –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ Telegram-–±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

| –°–∏—Å—Ç–µ–º–∞            | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                             |
| ------------------ | -------------------------------------- |
| InfluxDB           | –•—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫                |
| Grafana            | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏–∑                  |
| Telegram           | –ê–ª–µ—Ä—Ç–∏–Ω–≥ –ø–æ `error` –∏ `critical`       |
| (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Loki | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ InfluxDB –¥–ª—è pure-logging |

> üí° –õ–æ–≥–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `LoggerAdapter` ‚Äî —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.  
> –û–Ω –∞–±—Å—Ç—Ä–∞–≥–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç use case —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ, –∞ –Ω–µ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ InfluxDB.
