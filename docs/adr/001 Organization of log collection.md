# ADR 001: Организация сбора логов

**Дата:** 2025-04-01  
**Участники:**

- Дмитрий Конорев (Директор sweep-it)
- Ваганов Антон (Инженер по организации управления производством)
- Антропов Андрей (Руководитель отдела разработки)
- Шведов Олег (Руководитель управления IT инфраструктуры)
- Лущиков Всеволод (DevOps)

## Статус

Принято  
_2025-04-01_

## Контекст

Необходимо выбрать решение для сбора логов, которое:

1. Покрывает потребности системных администраторов в мониторинге.
2. Обеспечивает минимальное время реакции на инциденты.
3. Может быть реализовано в кратчайшие сроки для MVP.

Текущие ограничения:

- Grafana уже развернут в инфраструктуре компании.
- Нагрузка на систему в первые 3 месяца ожидается низкая (<100 RPS).

## Варианты решения

### 1. Локальное хранение в файлах (.log)

**✅ Преимущества:**

- Мгновенная реализация (не требует интеграций)
- Нулевые дополнительные затраты
- Простота

**❌ Недостатки:**

- Отсутствие алертинга
- Невозможность централизованного анализа
- Ручной парсинг для диагностики

### 2. Grafana + Loki (существующее решение)

**✅ Преимущества:**

- Готовые дашборды и алертинг
- Интеграция с текущим стеком мониторинга
- Поддержка запросов LogQL

**❌ Недостатки:**

- Требует настройки конвейера сбора логов
- Неоптимален для full-text поиска
- Избыточный функционал
- Сложность

### 3. ELK-стек (Elasticsearch + Logstash + Kibana)

**✅ Преимущества:**

- Мощные возможности анализа
- Гибкие схемы индексации

**❌ Недостатки:**

- Высокие требования к ресурсам
- Необходимость сопровождения отдельного кластера

## Решение

**Выбранный вариант:** Гибридный подход

1. **Кратковременно (0-2 месяца):** Локальные логи (вариант 1)
   - _Причина:_ Позволяет запустить MVP без задержек
2. **Постоянно (после Q2 2025):** Grafana Loki (вариант 2)
   - _Причина:_ Использование уже развернутой инфраструктуры

**Критерии выбора:**

- Сроки реализации (MVP vs долгосрочное решение)
- Стоимость владения
- Соответствие инфраструктурным стандартам компании

## Последствия

### Положительные

- Быстрый старт с минимальными затратами
- Плавный переход на промышленное решение
- Использование утвержденных инструментов

### Отрицательные

- Двойная работа
- Ограниченная функциональность на первом этапе

### Риски и меры их смягчения

| Риск                               | Вероятность | Влияние | Меры                        |
| ---------------------------------- | ----------- | ------- | --------------------------- |
| Задержка миграции на Grafana       | Средняя     | Высокое | Закрепить ресурсы в бэклоге |
| Нехватка места для локальных логов | Низкая      | Среднее | Настроить logrotate         |

## Дополнительные материалы
