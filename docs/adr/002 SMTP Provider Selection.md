# ADR 002: Выбор SMTP сервиса

**Дата:** 2025-04-01  
**Участники:**

- Дмитрий Конорев (Директор sweep-it)
- Ваганов Антон (Инженер по организации управления производством)
- Антропов Андрей (Руководитель отдела разработки)
- Шведов Олег (Руководитель управления IT инфраструктуры)
- Лущиков Всеволод (DevOps)

## Статус

Принято  
_2025-04-01_

## Контекст

Необходимо выбрать решение для отправки **транзакционных писем**, которое также может быть использовано для маркетинговых рассылок в будущем.

### Требования:

- Возможность масштабирования под маркетинговые кампании.
- Простая интеграция в существующую экосистему компании.
- Отсутствие ограничений на количество отправляемых писем в день.
- Надежная доставляемость и защита от попадания в спам.

### Ограничения:

- У компании уже развернут собственный SMTP-сервер.
- Общая стоимость обслуживания не должна превышать текущие затраты на Bitrix.
- Желание сохранить контроль над всей цепочкой доставки писем.

## Варианты решения

### 1. Yandex Cloud

**✅ Преимущества:**

- Высокая надежность и доставляемость (инфраструктура Яндекса).
- Гибкая тарификация: 70 руб./1 тыс. писем; первые 2 тыс. — бесплатно каждый месяц.
- Отличная масштабируемость как облачное решение.
- Поддержка API, SDK и сторонних интеграций.
- Высокий уровень безопасности.

**❌ Недостатки:**

- Базовая аналитика (требуется интеграция со сторонними системами).
- Нет возможности для маркетинговых рассылок.
- Требует настройки кастомизации через API.

### 2. DashaMail

**✅ Преимущества:**

- Есть бесплатный пробный период (14 дней).
- Поддержка маркетинговых и транзакционных рассылок.
- Хорошая аналитика и отчеты.
- Интеграции с CRM и API.
- Доступная поддержка 24/7.

**❌ Недостатки:**

- Сравнительно высокая стоимость — от 760 руб./мес.
- Ограниченная масштабируемость по сравнению с облачными решениями.

### 3. Unisender

**✅ Преимущества:**

- Бесплатный пробный период (30 дней).
- Полная поддержка маркетинговых и транзакционных рассылок.
- Гибкие настройки и хорошая аналитика.
- Высокая скорость и надежность доставки.
- Разумная стоимость — от 670 руб./мес., есть бесплатный тариф.

**❌ Недостатки:**

- Нет явных преимуществ перед другими SaaS-решениями по функционалу.
- Требует настройки при сложной интеграции.

### 4. SendPulse

**✅ Преимущества:**

- Бесплатный пробный период (7 дней).
- Поддержка маркетинговых и транзакционных рассылок.
- Гибкие настройки и хороший интерфейс.
- Аналитика и отчеты.
- Поддержка API и интеграции с CRM.
- Доступен англоязычный интерфейс и поддержка.

**❌ Недостатки:**

- Сравнительно короткий пробный период.
- Цена начинается от $8/мес., что выше некоторых альтернатив.

### 5. Mailopost

**✅ Преимущества:**

- Бесплатный пробный период (14 дней).
- Поддержка маркетинговых и транзакционных рассылок.
- Гибкие настройки и хорошая аналитика.
- Поддержка API и интеграции с CRM.
- Бесплатный тариф при базе до 200 контактов.
- Российский сервер и локализация.

**❌ Недостатки:**

- Средняя узнаваемость бренда на рынке.
- Сравнительно высокая стоимость — от 770 руб./мес.

### 6. Свой SMTP-сервер

**✅ Преимущества:**

- Полный контроль над сервером и процессом отправки.
- Нулевые ежемесячные расходы после настройки.
- Нет зависимости от внешних провайдеров.
- Полная гибкость настроек и возможность кастомизации.
- Соответствует политике информационной независимости компании.

**❌ Недостатки:**

- Необходимость ручного управления доставляемостью и черными списками.
- Высокая трудоемкость настройки и поддержания.
- Риск попадания в спам без должной настройки SPF/DKIM/DMARC.
- Отсутствие готовой аналитики и отчетов.
- Ограниченная масштабируемость без дополнительных ресурсов.
- Требует постоянного мониторинга и обслуживания.

## Решение

**Выбранный вариант:** Использование **собственного SMTP-сервера** на условиях тестирования.

- _Причина:_ Минимизация затрат, использование уже развёрнутой инфраструктуры, полный контроль над процессом доставки.
- _Примечание:_ Решение принимается в режиме тестирования с возможностью замены на внешний сервис при возникновении существенных проблем (низкая доставляемость, рост нагрузки, сложности эксплуатации).

**Критерии выбора:**

- Соответствие бюджетным ограничениям.
- Интеграция с текущей инфраструктурой.
- Полный контроль над доставкой писем.
- Гибкость для последующего перехода на стороннее решение при необходимости.

## Последствия

### Положительные

- Использование существующего решения минимизирует начальные затраты.
- Сервер уже используется маркетологами для маркетинговой рассылки.
- Команда админов уже имеет опыт эксплуатации и настройки сервера.
- Отсутствие привязки к стороннему провайдеру.
- Возможность постепенной оценки эффективности внутреннего сервера без долгосрочных обязательств.
- Гибкость архитектуры позволяет оперативно переключиться на внешний сервис при необходимости.

### Отрицательные

- Ограниченная аналитика и отсутствие автоматических отчетов.
- Ограничение на рассылку писем в день (требует оптимизации очередей).
- Повышенная нагрузка на админов для обеспечения надёжности и доставляемости.

## Риски и меры их смягчения

| Риск                                                  | Вероятность | Влияние | Меры по смягчению                                                                             |
| ----------------------------------------------------- | ----------- | ------- | --------------------------------------------------------------------------------------------- |
| Проблемы с доставляемостью писем                      | Средняя     | Высокое | Настройка SPF, DKIM, DMARC; регулярный аудит репутации IP и домена                            |
| Попадание в спам-листы                                | Средняя     | Высокое | Использование инструментов мониторинга (например, MXToolbox), своевременная реакция на жалобы |
| Ограничения на объём рассылок                         | Высокая     | Среднее | Оптимизация очереди отправки, ограничение одновременной нагрузки                              |
| Нехватка аналитики                                    | Высокая     | Среднее | Разработка минимального дашборда мониторинга доставки внутри компании                         |
| Перегрузка админов                                    | Средняя     | Среднее | Автоматизация типовых задач (через Ansible, SaltStack и т.п.), документирование               |
| Снижение качества технической поддержки при проблемах | Низкая      | Низкое  | Обучение команды, создание чек-листов и runbook'ов для частых сценариев                       |
| Необходимость внеплановой смены решения               | Низкая      | Высокое | Поддержание возможности интеграции с внешними провайдерами на уровне кода и конфигураций      |

## Дополнительные материалы

- [Yandex Cloud — Email Sending](https://cloud.yandex.ru/docs/solutions/email-sending)
- [DashaMail тарифы и функционал](https://www.dashamail.ru/)
- [Unisender — тарифы и описание](https://unisender.com/)
- [SendPulse — тарифы и интеграции](https://sendpulse.com/)
- [Mailopost — тарифы и описание](https://mailopost.ru/)
