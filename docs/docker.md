# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

–°–µ—Ä–≤–∏—Å—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (`notification-service`, `retry-service`) –ø–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∫–∞–∫ **stateless Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ [12-Factor App](https://12factor.net/).  
–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è **–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** ‚Äî –≤ –æ–±—Ä–∞–∑–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã, —Å–µ–∫—Ä–µ—Ç—ã –∏–ª–∏ –∂—ë—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

> üí° –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ **–º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è**.  
> –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ [`docker-compose.yml`](../docker-compose.yml) –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

---

## –°–±–æ—Ä–∫–∞

–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è **–∏–∑ –∫–æ—Ä–Ω—è –º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º multi-stage `Dockerfile`, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –≤ –µ–≥–æ workspace:

```bash
# –ü—Ä–∏–º–µ—Ä –¥–ª—è notification-service
docker build \
  -f services/notification-service/Dockerfile \
  -t notification-service:latest \
  services/notification-service

# –ü—Ä–∏–º–µ—Ä –¥–ª—è retry-service
docker build \
  -f services/retry-service/Dockerfile \
  -t retry-service:latest \
  services/retry-service
```

–û–±—Ä–∞–∑—ã —Å–æ–¥–µ—Ä–∂–∞—Ç:
- –¢–æ–ª—å–∫–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π production-–∫–æ–¥ (`dist/`),
- –¢–æ–ª—å–∫–æ production-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`npm ci --only=production`).

> ‚úÖ **–í–∞–∂–Ω–æ**: —Å–±–æ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–∏–∑ –∫–æ—Ä–Ω—è**, –Ω–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Äî –ø–∞–ø–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (`services/<service-name>`).  
> –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤ –æ–±—Ä–∞–∑ –ø–æ–ø–∞–¥—É—Ç —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

---

## –ó–∞–ø—É—Å–∫

–í production –æ–±—Ä–∞–∑—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, Kubernetes), —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤.

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `docker-compose`:

```bash
# –ó–∞–ø—É—Å–∫ notification-service
docker-compose up --build notification-service

# –ó–∞–ø—É—Å–∫ retry-service
docker-compose up --build retry-service

# –ó–∞–ø—É—Å–∫ –≤—Å–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
docker-compose up --build
```

> ‚ö†Ô∏è –§–∞–π–ª—ã `.env` **–Ω–µ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ –æ–±—Ä–∞–∑—ã**.  
> –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–¥–∞—é—Ç—Å—è:
> - –≤ `docker-compose.yml` —á–µ—Ä–µ–∑ `env_file` (–¥–ª—è dev),
> - —á–µ—Ä–µ–∑ —Å–µ–∫—Ä–µ—Ç—ã –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚Äî –≤ production.

---

## –ö–æ–Ω—Ç—Ä–∞–∫—Ç –æ–±—Ä–∞–∑–∞

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å–ª–µ–¥—É—é—Ç –µ–¥–∏–Ω–æ–º—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É:

| –ü–∞—Ä–∞–º–µ—Ç—Ä               | –ó–Ω–∞—á–µ–Ω–∏–µ                                    |
|------------------------|---------------------------------------------|
| **Dockerfile**         | `services/<service-name>/Dockerfile`        |
| **–ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑**      | `node:23.11.0-alpine`                       |
| **–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è** | `/app`                                      |
| **–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞**    | `node dist/index.js`                        |
| **–ü–æ—Ä—Ç**               | `3000` (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `SERVICE_PORT`) |
| **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**       | –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è           |

> üîí –û–±—Ä–∞–∑—ã **–Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç**:
> - –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ (—Ç–æ–ª—å–∫–æ `dist/`),
> - dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π,
> - `.env`-—Ñ–∞–π–ª–æ–≤,
> - —Å–∫—Ä–∏–ø—Ç–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–π.

---

## –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

| –°–µ—Ä–≤–∏—Å                | –¢—Ä–µ–±—É–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏                         |
|-----------------------|-----------------------------------------------|
| `notification-service`| RabbitMQ, Bitrix24, SMTP, OTel Collector      |
| `retry-service`       | RabbitMQ, OTel Collector                      |

> üîê –°–µ–∫—Ä–µ—Ç—ã **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ –æ–±—Ä–∞–∑**. –í `docker-compose` –æ–Ω–∏ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `env_file`, –≤ production ‚Äî —á–µ—Ä–µ–∑ —Å–µ–∫—Ä–µ—Ç—ã –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

---

## –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

–û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å–∫–∞ ‚Äî —á–µ—Ä–µ–∑ `docker-compose.yml` –≤ –∫–æ—Ä–Ω–µ:

```yaml
# docker-compose.yml (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)
services:
  notification-service:
    build:
      context: ./services/notification-service
      dockerfile: Dockerfile
    env_file: ./services/notification-service/.env.dev
    ports: ["3000:3000"]
    depends_on: [rabbitmq]

  retry-service:
    build:
      context: ./services/retry-service
      dockerfile: Dockerfile
    env_file: ./services/retry-service/.env.dev
    depends_on: [rabbitmq]
```

> üí° –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ RabbitMQ, Keycloak –∏ –¥—Ä—É–≥–∏—Ö –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ [`infra/`](../infra/) –∏ –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `volumes`.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ–≥–∏** (`v1.2.3`), **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `latest`**.
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å `.env.dev` –≤ –∫–∞–∂–¥–æ–π –ø–∞–ø–∫–µ —Å–µ—Ä–≤–∏—Å–∞.
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —á–µ—Ä–µ–∑ `docker-compose`, –∞ –Ω–µ `docker run`.
- üîÑ –í CI/CD:
  - –°–æ–±–∏—Ä–∞–π—Ç–µ –æ–±—Ä–∞–∑—ã —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º `services/<service-name>`,
  - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–æ –∑–∞–ø—É—Å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ init-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã).

---

> üí° –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–¥ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é:
>
> - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **liveness/readiness probes** (`/api/health/live`, `/api/health/ready`),
> - **Stateless** —Ä–∞–±–æ—Ç–∞ —Å –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (–æ—á–µ—Ä–µ–¥–∏, DLQ),
> - **–°–∫–≤–æ–∑–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞** —á–µ—Ä–µ–∑ `traceId` –∏ OpenTelemetry.
>
> –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Kubernetes.  
> –ù–∞ —Ç–µ–∫—É—â–µ–º —ç—Ç–∞–ø–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ `docker-compose`.