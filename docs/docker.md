# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

–°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (`notification-service`) –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ **stateless Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ [12-Factor App](https://12factor.net/).  
–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è **–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** ‚Äî –≤ –æ–±—Ä–∞–∑–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã, —Å–µ–∫—Ä–µ—Ç—ã –∏–ª–∏ –∂—ë—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

---

## –°–±–æ—Ä–∫–∞

–û–±—Ä–∞–∑ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **multi-stage Dockerfile** –Ω–∞ –±–∞–∑–µ `node:23.11.0-alpine` –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç:

- –¢–æ–ª—å–∫–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π production-–∫–æ–¥ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `dist/`,
- –¢–æ–ª—å–∫–æ production-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`npm ci --only=production`).

```bash
docker build -t notification-service .
```

> –ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞, –≥–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω `Dockerfile`.

---

## –ó–∞–ø—É—Å–∫

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
docker run -d \
  --name notification-service \
  --env-file .env \
  -p 3000:3000 \
  notification-service
```

> –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (—Å–º. [.env.example](../.env.example)).  
> –°–µ–∫—Ä–µ—Ç—ã **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–ª–∂–Ω—ã –∫–æ–º–º–∏—Ç–∏—Ç—å—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**.

---

## –ö–æ–Ω—Ç—Ä–∞–∫—Ç –æ–±—Ä–∞–∑–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä               | –ó–Ω–∞—á–µ–Ω–∏–µ                                    |
| ---------------------- | ------------------------------------------- |
| **–ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑**      | `node:23.11.0-alpine`                       |
| **–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è** | `/app`                                      |
| **–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞**    | `node dist/index.js`                        |
| **–ü–æ—Ä—Ç**               | `3000` (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `SERVICE_PORT`) |
| **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**       | –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è           |

> –û–±—Ä–∞–∑ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞, dev-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –º–∏–≥—Ä–∞—Ü–∏–π –∏–ª–∏ `.env`-—Ñ–∞–π–ª–æ–≤.

---

## –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç—Ä–µ–±—É–µ—Ç —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–ª–µ–¥—É—é—â–∏–º –≤–Ω–µ—à–Ω–∏–º —Å–∏—Å—Ç–µ–º–∞–º –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:

| –°–∏—Å—Ç–µ–º–∞                     | –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è   |
| --------------------------- | ---------------------- |
| **RabbitMQ**                | `RABBITMQ_*`           |
| **Bitrix24**                | `BITRIX_CHANNEL_*`     |
| **SMTP**                    | `EMAIL_CHANNEL_*HOST*` |
| **OpenTelemetry Collector** | `TELEMETRY_*`          |

> üîê –°–µ–∫—Ä–µ—Ç—ã **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ –æ–±—Ä–∞–∑** ‚Äî –æ–Ω–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑:
>
> - `.env`-—Ñ–∞–π–ª—ã (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞),
> - —Å–µ–∫—Ä–µ—Ç—ã –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (Kubernetes `Secrets`, Docker Swarm secrets –∏ —Ç.–¥.) –≤ production.

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ–≥–∏ –æ–±—Ä–∞–∑–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `notification-service:v1.2.3`), **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `latest`**.
- ‚úÖ –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **RabbitMQ, SMTP –∏ Bitrix24 –¥–æ—Å—Ç—É–ø–Ω—ã** ‚Äî **healthcheck –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –Ω–∏—Ö**.
- ‚úÖ –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--env-file .env.dev` –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ `.env.dev` –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å [.env.example](../.env.example).
- üîÑ –í CI/CD:
  - –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ **–¥–æ** —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
    ```bash
    npm ci
    npm run migrate:prod
    ```
  - –°–æ–±–∏—Ä–∞–π—Ç–µ Docker-–æ–±—Ä–∞–∑ —Å —Ç–µ–≥–æ–º, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –≤–µ—Ä—Å–∏–∏ –∏–∑ `package.json`.
  - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–ø—É—â–µ–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã **–¥–æ** –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ init-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–ª–∏ readiness-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏).

---

> üí° –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–¥ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é:
>
> - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **liveness/readiness probes** (`/api/health/live`, `/api/health/ready`),
> - **Stateless** —Ä–∞–±–æ—Ç–∞ —Å –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (–æ—á–µ—Ä–µ–¥–∏, retry-–ª–æ–≥–∏–∫–∞),
> - **–°–∫–≤–æ–∑–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞** —á–µ—Ä–µ–∑ `traceId` –∏ OpenTelemetry.
>
> –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Kubernetes –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –≤ –±—É–¥—É—â–µ–º.  
> –ù–∞ —Ç–µ–∫—É—â–µ–º —ç—Ç–∞–ø–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ `docker run`.
